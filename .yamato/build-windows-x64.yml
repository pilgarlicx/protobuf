name: Build protobuf - Windows 10 x64

agent:
  type: Unity::VM
  image: desktop/desktop-vs2019:latest
  flavor: b1.medium

artifacts:
  build:
    paths:
      - out/**

commands:
  - |
    SetupVS.bat
    mkdir install
    cd cmake
    mkdir build
    cd build
    mkdir release
    cd release
    cmake -G "NMake Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../../../../install ../..
    nmake
    nmake install
  - |
    xcopy install\bin out\build\bin\win64 /s /i
    xcopy install\lib out\build\lib\win64 /s /i
    xcopy install\include out\build\include /s /i
