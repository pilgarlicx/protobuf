name: Build protobuf - macOS x86_64 10.12

agent:
  type: Unity::VM::osx
  image: sustained-engineering/scd-macos-test-environment:v0.2.5-570490
  flavor: b1.medium

artifacts:
  build.zip:
    paths:
      - out/**

commands:
- brew install autoconf automake libtool
- ./autogen.sh
- ./configure UNITY_TARGET=macos_x86_64 --prefix=$PWD/x86_64
- make
- make install
- mkdir -p out/build/bin/macos/x86_64
- cp -R $PWD/x86_64/bin/* out/build/bin/macos/x86_64
- mkdir -p out/build/lib/macos/x86_64
- cp -R $PWD/x86_64/lib/* out/build/lib/macos/x86_64
- mkdir -p out/build/include
- cp -R $PWD/x86_64/include/* out/build/include